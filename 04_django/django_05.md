# Django 05



## Authentication & Authorization



- Authentication
  - ì¸ì¦
  - ì‹ ì› í™•ì¸
- Authorization
  - ê¶Œí•œ, í—ˆê°€
  - ê°€ê³  ì‹¶ì€ ê³³ìœ¼ë¡œ ê°€ë„ë¡ í˜¹ì€ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì–»ë„ë¡ í—ˆìš©í•˜ëŠ” ê³¼ì •



### Django Authentication System

- ì¸ì¦, ê¶Œí•œ ë¶€ì—¬ë¥¼ í•¨ê»˜ ê²°í•©í•˜ì—¬ ì œê³µ
- User object
- Web request



### Authentication Built-in Forms

- built in form
- UserCreationForm
  - íšŒì›ê°€ì…
- AuthenticationForm
  - ë¡œê·¸ì¸



## Login &Logout



### Authentication in Web requests

> DjangoëŠ” ì„¸ì…˜ê³¼ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•´ 
>
> ì´ë¯¸ ì¸ì¦ ì‹œìŠ¤í…œì„ request ê°ì²´ì— ì—°ê²°



- ì‚¬ìš©ìê°€ ë‚˜íƒ€ë‚´ëŠ” ëª¨ë“  ìš”ì²­ì— `request.user` ì œê³µ
- ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í•˜ì§€ ì•Šì€ ê²½ìš° `AnonymousUser`  í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì„¤ì •ë˜ê³ 
- ë¡œê·¸ì¸ í•œ ê²½ìš°, `User` í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì„¤ì •



### ë¡œê·¸ì¸

- ë¡œê·¸ì¸ì€ Session ì„ create í•˜ëŠ” ë¡œì§ê³¼ ê°™ë‹¤
- `login()`
  - í˜„ì¬ ì„¸ì…˜ì— ì—°ê²°í•˜ë ¤ëŠ” ì¸ì¦ëœ ì‚¬ìš©ìê°€ ìˆëŠ” ê²½ìš° login() í•¨ìˆ˜ë¡œ ë¡œê·¸ì¸ ì§„í–‰
  - **request** ê°ì²´ì™€ **User** ê°ì²´ë¥¼ í†µí•´ ë¡œê·¸ì¸ ì§„í–‰
  - session frameworkë¥¼ í†µí•´ ì‚¬ìš©ì ID ë¥¼ ì„¸ì…˜ì— ì €ì¥



### ë¡œê·¸ì•„ì›ƒ

- ë¡œê·¸ì•„ì›ƒì€ ì„¸ì…˜ì„ delete í•˜ëŠ” ë¡œì§ê³¼ ê°™ë‹¤
- logout()
  - request ê°ì²´ë¥¼ ë°›ìœ¼ë©° returnì´ ì—†ìŒ
  - í˜„ì¬ ìš”ì²­ì— ëŒ€í•œ DBì˜ ì„¸ì…˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  
  - í´ë¼ì´ì–¸íŠ¸ ì¿ í‚¤ì—ì„œ `sessionid` ì‚­ì œ



### HTTP(HyperText Transfer Protocol)

- HTML ë¬¸ì„œì™€ ê°™ì€ ë¦¬ì†ŒìŠ¤ë“¤ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” í”„ë¡œí† ì½œ (ê·œì¹™, ì•½ì†)
- ì›¹ì—ì„œ ì´ë£¨ì–´ì§€ëŠ” ëª¨ë“  ë°ì´í„° êµí™˜ì˜ ê¸°ì´ˆ
- í´ë¼ì´ì–¸íŠ¸ - ì„œë²„ í”„ë¡œí† ì½œ
- requests
  - í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ì— ì˜í•´ ì „ì†¡ë˜ëŠ” ë©”ì‹œì§€
- response
  - ì„œë²„ì—ì„œ ì‘ë‹µìœ¼ë¡œ ì „ì†¡ë˜ëŠ” ë©”ì‹œì§€

- HTTP íŠ¹ì§•
  - **ë¹„ì—°ê²°ì§€í–¥(connectionless)**
    - ì„œë²„ëŠ” ì‘ë‹µ í›„ ì ‘ì†ì„ ëŠìŒ
  - **ë¬´ìƒíƒœ(stateless)**
    - ì ‘ì†ì´ ëŠì–´ì§€ë©´ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ í†µì‹ ì´ ëë‚˜ë©° **ìƒíƒœë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŒ**

##### ì´ íŠ¹ì§•ì„ ë›°ì–´ ë„˜ê¸° ìœ„í•œ í•´ê²° ì±…? cookie

##### opposite: socket io í†µì‹ 

- ê²Œì„, ì±„íŒ… ë“± ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ 
- HTTP ì™€ ë‹¤ë¥´ë‹¤
- request ê°€ ì—†ì–´ë„ response ë¥¼ ì¤„ ìˆ˜ ìˆëŠ”
- web hook (telegram bot ì²˜ëŸ¼ ë‚¨ì˜ ì»´í“¨í„°ë¡œ response ë³´ë‚´ê¸°)







### Cookie

- ì„œë²„ê°€ ì‚¬ìš©ìì˜ ì›¹ ë¸Œë¼ìš°ì €ì— ì „ì†¡í•˜ëŠ” ì‘ì€ ë°ì´í„° ì¡°ê°
- ë¸Œë¼ìš°ì €(í´ë¼ì´ì–¸íŠ¸)ëŠ” ì „ì†¡ë°›ì€ ì¿ í‚¤ë¥¼ ë¡œì»¬ì— key-value ì˜ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ì €ì¥
  - ë™ì¼í•œ ì„œë²„ì— ì¬ ìš”ì²­ì‹œ ì €ì¥ëœ ì¿ í‚¤ë¥¼ í•¨ê»˜ ì „ì†¡
- ì›¹í˜ì´ì§€ì— ì ‘ì†í•˜ë©´ ìš”ì²­í•œ ì›¹í˜ì´ì§€ë¥¼ ë°›ìœ¼ë©° ì¿ í‚¤ë¥¼ ë¡œì»¬ì— ì €ì¥í•˜ê³ 
- í´ë¼ì´ì–¸íŠ¸ê°€ ì¬ìš”ì²­ì‹œ ë§ˆë‹¤ ì›¹í˜ì´ì§€ ìš”ì²­ê³¼ í•¨ê»˜ ì¿ í‚¤ ê°’ë„ ê°™ì´ ì „ì†¡



#### ì‚¬ìš© ëª©ì 

- **ì„¸ì…˜ê´€ë¦¬**
  - ë¡œê·¸ì¸, ì•„ì´ë”” ìë™ì™„ì„±, ê³µì§€ í•˜ë£¨ ì•ˆ ë³´ê¸°, íŒì—… ì²´í¬, ì¥ë°”êµ¬ë‹ˆ ë“±ì˜ ì •ë³´ ê´€ë¦¬
  - ìƒíƒœë¥¼ ë§Œë“¤ê¸° ìœ„í•¨
- ê°œì¸í™”
  - ì‚¬ìš©ì ì„ í˜¸, í…Œë§ˆ ë“±ì˜ ì„¸íŒ…
  - ê°œì¸ì •ë³´ ìˆ˜ì§‘ì„ í†µí•´ ë§ì¶¤ ì½˜í…ì¸  ì œê³µ
- íŠ¸ë˜í‚¹
  - ì‚¬ìš©ì í–‰ë™ì„ ê¸°ë¡ ë° ë¶„ì„í•˜ëŠ” ìš©ë„
  - ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ì¿ í‚¤ ì‚¬ìš©ì— ëŒ€í•œ ì„ íƒê¶Œì„ ì£¼ëŠ” í¸



#### Session

- ì‚¬ì´íŠ¸ì™€ íŠ¹ì • ë¸Œë¼ìš°ì € ì‚¬ì´ì˜ **state** ë¥¼ ìœ ì§€ì‹œí‚¤ëŠ” ê²ƒ (opposite  of ë¬´ìƒíƒœ)
- í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì ‘ì†í•˜ë©´ ì„œë²„ê°€ íŠ¹ì • `session id` ë°œê¸‰
- í´ë¼ì´ì–¸íŠ¸ëŠ” `session id`ë¥¼ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•´ ì €ì¥
- í´ë¼ì´ì–¸íŠ¸ê°€ ë‹¤ì‹œ ì„œë²„ ì ‘ì† í•  ë•Œ í•´ë‹¹ ì¿ í‚¤ ( session id ì €ì¥ëœ)ë¥¼ ì´ìš©í•´ ì„œë²„ì— session id ì „ë‹¬
- django ëŠ” íŠ¹ì • session idë¥¼ í¬í•¨í•˜ëŠ” ì¿ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ ê°ê°ì˜ ë¸Œë¼ìš°ì €ì™€ ì‚¬ì´íŠ¸ê°€ ì—°ê²°ëœ ì„¸ì…˜ì„ ì•Œì•„ëƒ„
  - ì„¸ì…˜ ì •ë³´ëŠ” django DBì˜ `django_session` í…Œì´ë¸”ì— ì €ì¥ë˜ì–´ ìˆë‹¤.
- ì£¼ë¡œ ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ì— ì‚¬ìš©



#### lifetime

1. Session cookie

   - í˜„ì¬ ì„¸ì…˜(current session)ì´ ì¢…ë£Œë˜ë©´ ì‚­ì œ
   - ë¸Œë¼ìš°ì €ëŠ” í˜„ì¬ ì„¸ì…˜ì´ ì¢…ë£Œë˜ëŠ” ì‹œê¸°ë¥¼ ì •ì˜
   - ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” ë‹¤ì‹œ ì‹œì‘í•  ë•Œ ì„¸ì…˜ ë³µì›(session restoring)ì„ ì‚¬ìš©í•´ ê³„ì† ì§€ì†ë˜ê²Œ í•¨

2. Permanent cookie

   - ìœ í†µê¸°í•œì„ ì§€ì •

   - Expires ì†ì„±ì— ì§€ì •ëœ ë‚ ì§œ
   - Max-age ì†ì„±ì— ì§€ì •ëœ ê¸°ê°„ì´ ì§€ë‚˜ë©´ ì‚­ì œ

- setting.pyì— session ìœ íš¨ê¸°ê°„ ì§€ì •í•˜ê¸°
  - https://docs.djangoproject.com/en/3.1/ref/settings/

![image-20210322140930540](django_05.assets/image-20210322140930540.png)

![image-20210322141119145](django_05.assets/image-20210322141119145.png)



##### ì •ë¦¬

- cookie
  - í´ë¼ì´ì–¸íŠ¸ ë¡œì»¬ì— íŒŒì¼ë¡œ ì €ì¥
- session
  - djangoëŠ” ì„œë²„ì— ì €ì¥
  - ì´ë•Œ ì„œë²„ì— ì €ì¥ëœ ì„¸ì…˜ ë°ì´í„°ë¥¼ êµ¬ë³„í•˜ê¸° ìœ„í•œ session idëŠ” ì¿ í‚¤ì— ì €ì¥
- HTTP ì¿ í‚¤ëŠ” ìƒíƒœê°€ ìˆëŠ” ì„¸ì…˜ì„ ë§Œë“¤ë„ë¡ í•´ì¤€ë‹¤.



## 1) login

### views

- django ê°€ ì œê³µí•˜ëŠ” `AuthenticationForm` ì‚¬ìš©

![image-20210322113853499](django_05.assets/image-20210322113853499.png)



- GET ìš”ì²­ì¼ ê²½ìš°

  - ë¹„ì–´ìˆëŠ” AuthenticationForm ì„ ì œê³µí•œë‹¤

- POST ìš”ì²­ì¼ ê²½ìš°

  - AuthenticationForm ëŠ” requestì™€ dataë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤.

    - ê¸°ì¡´ ì¼ë°˜ form ê³¼ ë‹¤ë¥¸ ì  : requestë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ í•„ìš”ë¡œ í•œë‹¤.

      ![image-20210322114415407](django_05.assets/image-20210322114415407.png)

  - ìœ íš¨í•œ form ì˜ ë‚´ìš©ì¼ ê²½ìš° (DBì˜ userì˜ Id, Password ì™€ ì¼ì¹˜í•œë‹¤ë©´)

  - user ê°ì²´ëŠ” `form.get_user()` ë©”ì„œë“œë¡œ ë°˜í™˜ë°›ëŠ”ë‹¤.

  - login() í•¨ìˆ˜ëŠ” request ì™€ user ê°ì²´ë¥¼ ì¸ìë¡œ ë°›ëŠ”ë‹¤.

    ![image-20210322114335138](django_05.assets/image-20210322114335138.png)

- ë¡œê·¸ì¸ì— ì„±ê³µí•  ê²½ìš°

  - ë¸Œë¼ìš°ì €ì˜ cookieì— session idê°€ ì €ì¥ëœ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

  - session id ëŠ” django ì˜ django_session í…Œì´ë¸”ì— ì €ì¥ë˜ì–´ ìˆë‹¤.

  - ì €ì¥ëœ sessionì˜ ì†ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ templateì—ì„œ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤

    - djangoëŠ” requestì— authentication ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸

      ![image-20210322114658939](django_05.assets/image-20210322114658939.png)

    - `request.user` í†µí•´ user idê°€ í•­ìƒ ì¶œë ¥ë˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

    - ë°”ë¡œ `user`ë¡œ ì“¸ ìˆ˜ë„ ìˆë‹¤.

    - ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ì‹¤í–‰í•˜ê¸° ì›í•œë‹¤ë©´ ì•„ë˜ì˜ ë‚´ìš© ì°¸ê³ 

      ![image-20210322114938591](django_05.assets/image-20210322114938591.png)



##### * context ì— ë”°ë¡œ requestë¥¼ ë„˜ê²¨ì£¼ì§€ ì•Šì•˜ëŠ”ë° ì–´ë–»ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€?

> ë‚´ì¥ë˜ì–´ ìˆëŠ” context ê°€ ìˆê¸° ë•Œë¬¸

![image-20210322140449386](django_05.assets/image-20210322140449386.png)

- debug
- request
- auth
- messages



##### * request.user ì„ ì‚¬ìš©í–ˆëŠ”ë° ì–´ë–»ê²Œ ë°”ë¡œ username ì´ ë‚˜ì˜¤ì§€?

- ë¯¸ë“¤ì›¨ì–´(SessionMiddleware) ë¥¼ ê±°ì¹˜ë©° cookie ì— ë‹´ê¸´ session_id ë¥¼ í†µí•´ decode ëœ user ê°ì²´ë¥¼ 
-  request.user ë¡œ ê°€ì§ˆ ìˆ˜ ìˆê²Œ ë˜ê³ 

- í´ë˜ìŠ¤ ë‚´ë¶€ str (ë§¤ì§ë©”ì„œë“œ)ê°€ username ì„ return í•˜ê³  ìˆê¸° ë•Œë¬¸

![image-20210323232119477](django_05.assets/image-20210323232119477.png)



## 2) logout

### views

```python
from django.contrib.auth import logout as auth_logout
```



![image-20210322224532930](django_05.assets/image-20210322224532930.png)





### * ë¡œê·¸ì¸ ì‚¬ìš©ìì— ëŒ€í•œ ì ‘ê·¼ ì œí•œ

#### 1) is_authenticated (attribute) <templateì—ì„œ ì²˜ë¦¬>

- User class ì˜ ì†ì„± (attributes) (ë©”ì„œë“œê°€ ì•„ë‹˜ ì£¼ì˜)
- ì‚¬ìš©ìê°€ ì¸ì¦ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°©ë²•
- User ì— í•­ìƒ True , AnonymousUser ì— ëŒ€í•´ì„œë§Œ í•­ìƒ False
- ì´ê²ƒì€ ê¶Œí•œ (permission) ê³¼ëŠ” ê´€ë ¨ì´ ì—†ë‹¤
- ì‚¬ìš©ìê°€ í™œì„±í™” ìƒíƒœ(active) ì´ê±°ë‚˜ ìœ íš¨í•œ ì„¸ì…˜(valid session)ì„ ê°€ì§€ê³  ìˆëŠ”ì§€ë„ í™•ì¸í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ë²„íŠ¼ì„ ê°€ë¦° ê²ƒ ë¿ì´ì§€ URL ë¡œëŠ” ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤
  - ë”°ë¼ì„œ viewì—ì„œ ì¶”ê°€ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.

```python
def login(request):

    if request.user.is_authenticated:  # ë©”ì„œë“œ í™•ì¸ ì „ì— ë¡œê·¸ì¸ ì—¬ë¶€ ë¶€í„° í™•ì¸í•œë‹¤. (ë¡œê·¸ì¸í•œ ìœ ì €ëŠ” ë‹¤ì‹œ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ë‹¤.)
        return redirect('articles:index')

    ...
```



#### 2) login_required (decorator) <viewì—ì„œ ì²˜ë¦¬>

- ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í–ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” viewë¥¼ ìœ„í•œ ë°ì½”ë ˆì´í„°
- ë¡œê·¸ì¸ ëœ ì‚¬ìš©ìì˜ ê²½ìš° í•´ë‹¹ view í•¨ìˆ˜ ì‹¤í–‰
- ë¡œê·¸ì¸ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” settings.LOGIN_URL ì— ì„¤ì •ëœ ê²½ë¡œë¡œ redirect ì‹œí‚´
  - LOGIN_URL ì˜ ê¸°ë³¸ê°’ì€ `/accounts/login/`
  - ìš°ë¦¬ê°€ appì˜ ì´ë¦„ì„ accountsë¥¼ ì‚¬ìš©í•œ ì´ìœ , djangoê°€ ê¸°ë³¸ URL ì„¤ì •ì„ ìœ„ì™€ ê°™ì´ í–ˆê¸° ë•Œë¬¸
  - create, update, delete

```python
from django.contrib.auth.decorators import login_required
```



- ë¡œê·¸ì¸ í•˜ì§€ ì•Šê³  URL ë¡œ createì— ì ‘ê·¼í•  ê²½ìš° login urlë¡œ redirect

![image-20210322143523392](django_05.assets/image-20210322143523392.png)

- ì£¼ì†Œì°½ì— ì£¼ëª©, 
- ëŒì•„ì˜¤ê¸° ì§ì „ì— ì ‘ê·¼í–ˆë˜ ê²½ë¡œê°€ ë‹´ê²¨ìˆë‹¤. 
- ì‘ì„±í•´ì„œ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ê²ƒì€ ìš°ë¦¬! (ìë™ìœ¼ë¡œ ë˜ì§€ëŠ” ì•ŠìŒ)
- **í˜„ì¬ nextê°€ ë¶™ì€ URL ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” form ì˜ actionì´ ë¹„ì›Œì ¸ìˆì–´ì•¼ í•œë‹¤!** 
- action = '#'  (í˜„ì¬ ì£¼ì†Œì°½ì— ì…ë ¥ë˜ì–´ ìˆëŠ” URLë¡œ ì´ë™í•œë‹¤.) 



##### ì£¼ì˜! delete ë…¼ë¦¬ì˜ ìƒì¶©

![image-20210322144540104](django_05.assets/image-20210322144540104.png)

- í•´ê²°í•˜ê¸°

  - ë‚´ë¶€ì—ì„œ if ë¬¸ ë¶„ê¸°ë¡œ í•´ê²°

  ```python
  # @login_required (GETìœ¼ë¡œ ìš”ì²­ë˜ê¸° ë•Œë¬¸ì— ë…¼ë¦¬ê°€ ìƒì¶©ëœë‹¤.)
  @require_POST
  def delete(request, pk):
  
      if request.user.is_authenticated:
          article = get_object_or_404(Article, pk=pk)
          article.delete()
      return redirect('articles:index')
  ```

  

## 3) SignUp (create)

- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœì¼ ë•Œ, íšŒì›ê°€ì…ì„ ì§„í–‰í•œë‹¤.
- `UserCreationForm`



![image-20210322152735796](django_05.assets/image-20210322152735796.png)

- form ê°ì²´ì˜ save ë©”ì„œë“œëŠ” ì €ì¥í•œ user ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤
- https://github.com/django/django/blob/main/django/contrib/auth/forms.py

![image-20210322151647653](django_05.assets/image-20210322151647653.png)



## 4) Delete

- ë¡œê·¸ì¸í•œ ìœ ì €ì¸ì§€ í™•ì¸
- í˜„ì¬ì˜ ìš”ì²­ì„ ë³´ë‚¸ user = `request.user` ë¥¼ ì‚­ì œí•œë‹¤.

![image-20210322152710245](django_05.assets/image-20210322152710245.png)





## 5) Update

> custom í•˜ì§€ ì•Šìœ¼ë©´ ë„ˆë¬´ ë§ì€ í•„ë“œë¥¼
>
> í•„ìš” ì´ìƒìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— (staff ê¶Œí•œ ê¹Œì§€ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.)
>
> custom ì´ í•„ìš”í•˜ë‹¤



### forms

- `UserChangeForm`ì„ ìƒì†ë°›ì•„ CustomUserChangeForm ì„ ì •ì˜í•œë‹¤.
- userì˜ ìƒì„±ê³¼ ìˆ˜ì •ì˜ form ì´ ë‚˜ë‰˜ëŠ” ì´ìœ ëŠ” ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì • ë•Œë¬¸ì´ë‹¤.
- **class Meta**
- userë¥¼ ì§ì ‘ ì¸ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ì§€ ì•Šê³  `get_user_model()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤.
- fields '__ all __'  ëŒ€ì‹ ì— ì‚¬ìš©í•  attribute ë§Œ íŠœí”Œ í˜•íƒœë¡œ ê°€ì ¸ì˜¨ë‹¤.
- trailing comma ì£¼ì˜

![image-20210322225218167](django_05.assets/image-20210322225218167.png)



### views

- custom í•œ `CustomUserChangeForm` ì„ import í•˜ì—¬ ì‚¬ìš©
  - data = request.POST
  - instance = request.user
- is_valid()

![image-20210322230304530](django_05.assets/image-20210322230304530.png)





## 6) Change Password

### Views

- ë³€ê²½ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ save í•˜ë©´ ë¡œê·¸ì•„ì›ƒ ëœë‹¤.

- ë¡œê·¸ì•„ì›ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ `update_session_auth_hash` ë©”ì„œë“œ ì‚¬ìš©

- PasswordChangeForm ì€ self.user í•„ë“œë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ `form.user` ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

  ![image-20210329133759918](django_05.assets/image-20210329133759918.png)





----



## 1. class User

> í˜„ì¬ ë”°ë¡œ ì¶”ê°€í•  í•„ë“œê°€ ì¡´ì¬í•˜ì§€ ì•Šë”ë¼ë„ 
>
> ì¶”í›„ì˜ í™•ì¥ì„ ìœ„í•´ ì„¤ê³„í•´ë‘”ë‹¤.



### 1-1. User objects

- django ì¸ì¦ ì‹œìŠ¤í…œì˜ í•µì‹¬
- Users ê°€ django ì¸ì¦ ì‹œìŠ¤í…œì—ì„œ í‘œí˜„ë˜ëŠ” ëª¨ë¸
- ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ì´íŠ¸ì™€ ìƒí˜¸ì‘ìš© í•˜ëŠ” ì‚¬ëŒë“¤ì„ ë‚˜íƒ€ëƒ„
- django ì¸ì¦ ì‹œìŠ¤í…œì—ì„œëŠ” ì˜¤ì§ í•˜ë‚˜ì˜ User Class ë§Œ ì¡´ì¬
- **AbstractUser** í´ë˜ìŠ¤ì˜ ìƒì†ì„ ë°›ìŒ
  - User modelì„ êµ¬í˜„í•˜ëŠ” ì™„ì „í•œ ê¸°ëŠ¥ì„ ê°–ì¶˜ ê¸°ë³¸ í´ë˜ìŠ¤
- https://github.com/django/django/blob/main/django/contrib/auth/models.py
- ì–´ë– í•œ ê²½ìš°ì—ë„ user ê°ì²´ë¥¼ ì§ì ‘ì ìœ¼ë¡œ import í•˜ì—¬ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ (ì§ì ‘ ì°¸ì¡° í•˜ì§€ ì•ŠëŠ”ë‹¤.)



#### ê¸°ë³¸ í•„ë“œ

- https://docs.djangoproject.com/en/3.1/topics/auth/default/

![image-20210322154912962](django_05.assets/image-20210322154912962.png)

- `from django.contrib.auth.models` `import User`

  

![image-20210322134324444](django_05.assets/image-20210322134324444.png)

- settings ì—ì„œ ì„¤ì •ë˜ì–´ ìˆëŠ” AUTH_USER_MODEL ì— ë“±ë¡ëœ User ë¥¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
- ë”°ë¼ì„œ custom Userë¥¼ ì‚¬ìš©í•  ê²½ìš°, ì € settings ê°’ì„ ë³€í™˜



##### ğŸƒ AUTH_USER_MODEL

- ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë¸ì˜ ì¡°ê±´
  - **`AbstractUser` ì„ ìƒì†ë°›ì•„ì•¼ í•œë‹¤.**
  - default ëŠ”` auth` ëª¨ë“ˆ ë‚´ë¶€ì˜ User
- Django project ëŠ” ë‹¨ 1 ê°œì˜ ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë¸ë§Œ í™œì„±í™” ê°€ëŠ¥í•˜ë‹¤
- í™•ì¥ì„ ìœ„í•´ ì»¤ìŠ¤í…€ ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë¸ì„ ì‚¬ìš©í•  ê²½ìš° (`accounts.models.User`) 
- get_user_model() í•¨ìˆ˜ì˜ return ëŒ€ìƒì´ ëœë‹¤.

```python
# íŒ¨í‚¤ì§€ ì°¸ì¡°í•˜ëŠ” ê²ƒê³¼ ëª¨ì–‘ì´ ë‹¤ë¥¸ ê²ƒì— ì£¼ì˜
# ì´ê±¸ swap í•˜ëŠ” ê·¸ ìˆœê°„ ë¶€í„° ê¸°ì¡´ ì½”ë“œì— auth.User ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ìˆë‹¤ë©´ ë‹¤ ë°”ê¾¸ì–´ì¤˜ì•¼ í•œë‹¤.
# ê¸°ë³¸ UserCreationForm, UserChangeForm ë„ custom í•´ì„œ model=get_user_model()ë¡œ ê°±ì‹ 
# ê¸°ì¡´ì˜ UserCreationFormì„ ì“°ë©´ì„œ is_valid() ë¥¼ ì¼ë”ë‹ˆ 
# manager is not available ì´ë¼ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë§Œë‚¬ë‹¤.
# ì™œëƒí•˜ë©´ ê¸°ì¡´ì˜ form ì€ auth.Userë¥¼ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

AUTH_USER_MODEL = 'accounts.User'
```





### 1-2. AbstractUser

- User ì˜ super class

![image-20210322134412909](django_05.assets/image-20210322134412909.png)

- customize í•˜ê¸° ìœ„í•´ì„œëŠ” ìƒì† ë°›ì•„ì„œ model ì„ ìƒì„±í• ê²ƒ 



### 1-3. í”„ë¡œì íŠ¸ì˜ User ë§Œë“¤ê¸°

#### models.py

![image-20210322134933205](django_05.assets/image-20210322134933205.png)





#### settings.py

- ë‚´ê°€ custom í•˜ì—¬ ì‘ì„±í•œ modelì˜ í´ë˜ìŠ¤ë¥¼ ë“±ë¡í•œë‹¤.
- get_user_model ë©”ì„œë“œëŠ” ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°ì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

![image-20210322134802521](django_05.assets/image-20210322134802521.png)



#### migrate

- model ì‘ì„±

- `AUTH_USER_MODEL` ë“±ë¡ í›„ migrate í•˜ë©´ 

- auth ê´€ë ¨ í…Œì´ë¸”ì´ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

  ![image-20210322135117517](django_05.assets/image-20210322135117517.png)



## 2. Class UserCreationForm

> íšŒì› ê°€ì… ì–‘ì‹



### 2-1. UserCreationForm



![image-20210322135824935](django_05.assets/image-20210322135824935.png)



### 2-2. í”„ë¡œì íŠ¸ íšŒì›ê°€ì… Form ë§Œë“¤ê¸°



## 3 Class UserChangeForm



### 3-1. UserChangeForm



##### get_user_model

- **User ëŠ” ì§ì ‘ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ”ë‹¤.**
- `django.contrib.auth.get_user_model`
- í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ í™œì„±í™”(active) ëœ user modelì„ return
- ì»¤ìŠ¤í…€í•œ user model ì´ ìˆì„ ê²½ìš°ëŠ” ì»¤ìŠ¤í…€ user modelì„ ì‚¬ìš©í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ User ì°¸ì¡°

![image-20210322154806954](django_05.assets/image-20210322154806954.png)





## Social Login



### OAuth

> ì¸í„°ë„· ì‚¬ìš©ìë“¤ì´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì œê³µí•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ìš°ë² ì‚¬ì´íŠ¸ ìƒì˜ ìì‹ ë“¤ì˜ ì •ë³´ì— ëŒ€í•´ ì›¹ì‚¬ì´íŠ¸ë‚˜ ì• í”Œë¦¬ ì¼€ì´ì…˜ì˜ ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆëŠ” ê³µí†µì ì¸ ìˆ˜ë‹¨ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.

https://d2.naver.com/helloworld/24942



### Allauth

https://django-allauth.readthedocs.io/en/latest/installation.html



### Google

- clientid
  - 950935977272-moivirth52q1k0pa2191aeeol26i4khg.apps.googleusercontent.com
- secretkey
  - W0mc80qBoGFL249s1oSjW-L3

